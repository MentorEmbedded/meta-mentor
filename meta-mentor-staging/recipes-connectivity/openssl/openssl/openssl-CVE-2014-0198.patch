openssl: fix for CVE-2014-0198

Upstream-Status: Backported

Signed-off-by: Priyanka Shobhan <priyanka_shobhan@mentor.com>

diff -u -p -r1.19.4.1 -r1.19.4.2
--- a/ssl/s3_pkt.c	12 Apr 2014 17:00:53 -0000	1.19.4.1
+++ b/ssl/s3_pkt.c	1 May 2014 14:17:40 -0000	1.19.4.2
@@ -657,6 +657,10 @@ static int do_ssl3_write(SSL *s, int typ
 		if (i <= 0)
 			return(i);
 		/* if it went, fall through and send more stuff */
+		/* we may have released our buffer, so get it again */
+		if (wb->buf == NULL)
+			if (!ssl3_setup_write_buffer(s))
+				return -1;
 		}
 
 	if (len == 0 && !create_empty_fragment)
