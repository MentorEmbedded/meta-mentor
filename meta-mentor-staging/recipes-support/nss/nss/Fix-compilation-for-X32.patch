From c8eadfcdfbc1d5a4799e9a264b0f859cb5954c05 Mon Sep 17 00:00:00 2001
From: Christopher Larson <chris_larson@mentor.com>
Date: Tue, 13 Dec 2016 11:40:47 -0700
Subject: [PATCH 7/7] Fix compilation for X32

X32 uses 32-bit pointers, not 64-bit.

Signed-off-by: Christopher Larson <chris_larson@mentor.com>
---
 nss/lib/freebl/poly1305-donna-x64-sse2-incremental-source.c | 4 ++++
 1 file changed, 4 insertions(+)

Index: nss-3.25/nss/lib/freebl/poly1305-donna-x64-sse2-incremental-source.c
===================================================================
--- nss-3.25.orig/nss/lib/freebl/poly1305-donna-x64-sse2-incremental-source.c
+++ nss-3.25/nss/lib/freebl/poly1305-donna-x64-sse2-incremental-source.c
@@ -79,7 +79,11 @@ typedef struct poly1305_state_internal_t
 
 static poly1305_state_internal INLINE
 *poly1305_aligned_state(poly1305_state *state) {
-	return (poly1305_state_internal *)(((uint64_t)state + 63) & ~63);
+#ifdef __ILP32__
+    return (poly1305_state_internal *)(((uint32_t)state + 63) & ~63);
+#else
+     return (poly1305_state_internal *)(((uint64_t)state + 63) & ~63);
+#endif
 }
 
 /* copy 0-63 bytes */
